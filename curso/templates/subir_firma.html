{% extends 'base_nav.html' %}
{% load static %}

{% block content %}
<!-- Bootstrap CSS -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<!-- Bootstrap Icons -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
<!-- Estilos personalizados -->
<link href="{% static 'css/firma.css' %}" rel="stylesheet">

<div class="container mt-4">
    <div class="firma-card">
        <div class="firma-card-header">
            <h4><i class="bi bi-pen"></i> Registrar Firma Digital</h4>
        </div>
        <div class="firma-card-body">
            <!-- Mensajes de alerta -->
            {% if messages %}
                {% for message in messages %}
                    <div class="alert alert-{% if message.tags == 'error' %}danger{% else %}{{ message.tags }}{% endif %} alert-dismissible fade show" role="alert">
                        {{ message }}
                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                    </div>
                {% endfor %}
            {% endif %}
            
            <div class="firma-alert">
                <strong>Requisitos:</strong> Imagen PNG o JPG con fondo transparente (máx. 500x200px)
            </div>

            <!-- Mostrar firma actual -->
            {% if user.firma_digital %}
            <div class="firma-actual mb-3">
                <h5>Firma actual:</h5>
                <img src="{{ user.firma_digital.url }}" alt="Su firma" class="firma-preview">
                <br>
            </div>
            {% endif %}

            <!-- Formulario subir firma -->
            <form method="post" enctype="multipart/form-data" class="firma-form">
                {% csrf_token %}
                <div class="firma-input-wrapper mb-3">
                    <label for="firma" class="firma-input-label">
                        <i class="bi bi-cloud-arrow-up fa-2x mb-2"></i><br>
                        Haga clic aquí o arrastre su archivo PNG/JPG
                    </label>
                    <input type="file" class="firma-input" id="firma" name="firma" accept="image/png, image/jpeg" required>
                </div>
                <div class="firma-buttons">
                    <button type="submit" class="firma-btn-primary">
                        <i class="bi bi-upload"></i> {% if user.firma_digital %}Actualizar{% else %}Subir{% endif %} Firma
                    </button>
                    <a href="{% url 'dashboard' %}" class="firma-btn-secondary">
                        <i class="bi bi-x"></i> Cancelar
                    </a>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- JavaScript para mejorar la experiencia de usuario -->
  <script src="{% static 'js/firma.js' %}"></script>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
{% endblock %}